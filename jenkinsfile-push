node {
    environment { 
        registry = "ycshin/nginx-webserver"
        registryCredential = 'docker-hub' 
        dockerImage = '' 
    }
     stage('Clone repository') {
         checkout scm
     }
     stage('Building our image') { 
        steps { 
            sh 'docker build -t $registry:latest .'
            sh 'docker build -t $registry:$BUILD_NUMBER .'
        } 
    }
    stage('Deploy docker image') { 
        steps { 
            withDockerRegistry([ credentialsId: registryCredential, url: "" ]) {
                sh 'docker push $registry:latest'
                sh 'docker push $registry:$BUILD_NUMBER'
            }
            
        }
    }
    stage('Clean docker image') {
        steps{
            sh "docker rmi $registry"
        }
    }
}