node {
    environment { 
        registry = "ycshin/nginx-webserver"
        registryCredential = 'docker-hub' 
        dockerImage = '' 
    }
     stage('Clone repository') {
         checkout scm
     }
     stage('Building our image') { 
        sh "docker build -t ${registry}:latest ."
        sh "docker build -t ${registry}:${BUILD_NUMBER} ."
    }
    stage('Deploy docker image') { 
        withDockerRegistry([ credentialsId: registryCredential, url: "" ]) {
            sh "docker push ${registry}:latest"
            sh "docker push ${registry}:${BUILD_NUMBER}"
        }
    }
    stage('Clean docker image') {
        sh "docker rmi ${registry}"
    }
}